#!/usr/bin/env python3.10
# coding: utf-8
# @carl9527


import pandas as pd


'''
Sample DataFrames
這個範例只能確保第一個column 能夠如預料的 merge 成一個 cell, 
從第二個 column 開始，不知道為何有時仍然沒有merge 在一起
'''
d1 = {
        "關鍵字": ["史帝夫","","","","","","","","","",""], 
        "備註": ["轉史帝夫","轉史帝夫","史帝夫","轉史帝夫","史帝夫","史帝夫","史帝夫","史帝夫","史帝夫","史帝夫","史帝夫"],
        "摘要": ["轉帳提", "轉帳提", "轉帳提", "轉帳提", "轉帳提", "轉帳提", "轉帳提", "轉帳提", "轉帳提", "轉帳提", "轉帳提"],
        "交易日期": ["2023/06/12", "2023/06/14", "2023/07/11", "2023/07/17","2023/08/11", "2023/08/18","2023/08/19", "2023/08/22","2023/09/13","2023/09/22","2023/10/16"],
        "交易時間": ["20:52:53", "14:46:42", "07:28:56", "15:23:06", "20:33:23", "14:12:40", "01:58:55", "13:49:49","19:26:42","01:38:40","20:16:52"],
        "交易代號": ["04055", "04055", "04055", "04055", "04055", "04055", "08055", "04055","04055","08055","04055"],
        "交易分行": ["0880", "0880", "0880", "0880", "0880", "0880", "0880", "0880","0880","0880","0880"],
        "交易櫃員": ["98984", "98983", "98984", "98941", "98942", "98942", "98981", "98932","98931","98931","98973"],
        "支出/out": ["1,998,000.00", "500,000.00", "740,000.00", "2,000,000.00", "2,000,000.00", "150,000.00", "1,800,000.00", "1,500,000.00","1,800,000.00","1,500,000.00","2,000,000.00"],
        "存入/in": ["", "", "", "", "", "", "", "","","",""]}
d2 = {
        "關鍵字": ["房租","","",""],
        "備註": ["2B房租,3月","2B房租4月","2B房租5月","2B房租6月"],
        "摘要": [f"轉帳", f"轉帳", f"轉帳", f"轉帳"],
        "交易日期": ["2023/05/09","2023/06/10","2023/07/01","2023/08/0"],
        "交易時間": ["01:59:28","11:52:19","15:07:19","01:41:34"],
        "交易代號": ["08045","08045","08045","08045"],
        "交易分行": ["0880","0880", "0880","0880"],
        "交易櫃員": ["98972","98971","98941","98981"],
        "支出/out": ["","","",""],
        "存入/in": ["5,500.00","6,105.00","5,910.00","6,120.00"]
        }
d3 = {
        "關鍵字": ["曾桂釵","",""],
        "備註": ["曾桂釵","曾桂釵律師","曾桂釵律師"],
        "摘要": ["電匯", "跨行轉", "跨行轉"],
        "交易日期": ["2023/07/12","2023/10/13","2023/10/26"],
        "交易時間": ["14:18:11","12:39:18","15:01:36"],
        "交易代號": ["01045","04050","04050"],
        "交易分行": ["0880","0880", "0880"],
        "交易櫃員": ["78088","98974","98931"],
        "支出/out": ["","10,000.00","5,000.00"],
        "存入/in": ["8,000.00","",""]
        }

'''
雖然這種方式很簡單可以做出個merged excel
但這裡必需注意，這樣產出的excel或是sheets 不適合再次讀進來做下一步的處理
也就是不適合當作中間產物讀進來處理，所以如果要坐中間產物，比較好的是先存如下的格式，最後再利用 df 做merge

|----------|-----------------------------|
| keyword1 | comment1                    |
|----------|-----------------------------|
| keyword1 | comment2                    |
|----------|-----------------------------|
| keyword1 | comment3                    |
|----------|-----------------------------|

之後再做成

|----------|-----------------------------|
|          | comment1                    |
|          |-----------------------------|
| keyword1 | comment2                    |
|          |-----------------------------|
|          | comment3                    |
|----------|-----------------------------|
'''
sink_excel = f'sink_excel.xlsx'
sink_hidx = ["關鍵字", "備註","摘要", "交易日期", "交易時間", "交易代號", "交易分行", "交易櫃員", "支出/out", "存入/in"]

def stylize_df(s):
    return "font-weight: normal; text-align: center; vertical-align: middle;"

(
    pd.DataFrame([d1, d2, d3])
        .apply(pd.Series.explode)
        .pivot_table(index=sink_hidx, sort=False)
        .style.applymap_index(stylize_df)
        .to_excel(sink_excel, startrow=-1)
)
